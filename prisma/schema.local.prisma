// Local database schema for offline mode
// This will be used when the app is offline and needs to store data locally

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client/local"
}

datasource db {
  provider = "sqlite"
  url      = env("LOCAL_DATABASE_URL")
}

// Copy of the main schema models with additional sync tracking fields

model User {
  id                String         @id @default(uuid())
  email             String         @unique
  name              String?
  password          String
  role              UserRole       @default(USER)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  subscriptions     Subscription[]
  organizationId    String?
  department        String?
  position          String?
  employeeId        String?
  contactNumber     String?
  status            UserStatus     @default(ACTIVE)
  permissions       String[]
  supervisor        String?
  hireDate          DateTime?
  createdBy         String?
  isOrganizationAdmin Boolean      @default(false)
  posts             Post[]
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Organization {
  id                String         @id @default(uuid())
  name              String
  type              OrganizationType
  licenseNumber     String?
  address           String?
  contactEmail      String?
  contactPhone      String?
  website           String?
  description       String?
  status            OrgStatus      @default(ACTIVE)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  parentId          String?
  children          Organization[] @relation("OrganizationHierarchy")
  users             User[]
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Subscription {
  id                String             @id @default(uuid())
  userId            String
  user              User               @relation(fields: [userId], references: [id])
  planId            String
  plan              SubscriptionPlan   @relation(fields: [planId], references: [id])
  status            SubscriptionStatus @default(ACTIVE)
  startDate         DateTime           @default(now())
  endDate           DateTime?
  autoRenew         Boolean            @default(true)
  paymentMethod     String?
  lastPaymentDate   DateTime?
  nextPaymentDate   DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  paymentHistory    Payment[]
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model SubscriptionPlan {
  id                String         @id @default(uuid())
  name              String
  description       String?
  price             Float
  currency          String         @default("USD")
  interval          PlanInterval
  intervalCount     Int            @default(1)
  features          String[]
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  subscriptions     Subscription[]
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Payment {
  id                String         @id @default(uuid())
  subscriptionId    String
  subscription      Subscription   @relation(fields: [subscriptionId], references: [id])
  amount            Float
  currency          String         @default("USD")
  status            PaymentStatus  @default(PENDING)
  paymentMethod     String?
  transactionId     String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Post {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id])
  content           String
  visibility        PostVisibility @default(PUBLIC)
  tradeSymbol       String?
  tradeType         TradeType?
  tradePrice        Float?
  analysisType      AnalysisType?
  analysisSummary   String?
  hashtags          String[]
  mentions          String[]
  attachments       Attachment[]
  likes             Int            @default(0)
  shares            Int            @default(0)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  comments          Comment[]
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Comment {
  id                String         @id @default(uuid())
  postId            String
  post              Post           @relation(fields: [postId], references: [id])
  userId            String
  content           String
  parentId          String?
  parent            Comment?       @relation("CommentReplies", fields: [parentId], references: [id])
  replies           Comment[]      @relation("CommentReplies")
  likes             Int            @default(0)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

model Attachment {
  id                String         @id @default(uuid())
  postId            String
  post              Post           @relation(fields: [postId], references: [id])
  type              AttachmentType
  url               String
  name              String
  size              Int
  createdAt         DateTime       @default(now())
  // Sync fields
  syncedAt          DateTime?
  syncStatus        SyncStatus     @default(PENDING)
  localId           String?        // Used to track local-only records
}

// Sync tracking model to keep track of sync operations
model SyncLog {
  id                String         @id @default(uuid())
  startedAt         DateTime       @default(now())
  completedAt       DateTime?
  status            String         @default("STARTED") // STARTED, COMPLETED, FAILED
  recordsProcessed  Int            @default(0)
  recordsSucceeded  Int            @default(0)
  recordsFailed     Int            @default(0)
  error             String?
  direction         SyncDirection  @default(TO_SERVER)
}

enum UserRole {
  USER
  INVESTOR
  ADMIN
  BROKER
  TRADER
  HR
  ACCOUNTING
  KELSOKO_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum OrganizationType {
  KELSOKO
  BANK
  BROKER
  FUND
  SPECULATOR
  OTHER
}

enum OrgStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
  FAILED
}

enum PlanInterval {
  MONTHLY
  QUARTERLY
  YEARLY
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PostVisibility {
  PUBLIC
  FOLLOWERS
  PRIVATE
}

enum TradeType {
  BUY
  SELL
}

enum AnalysisType {
  TECHNICAL
  FUNDAMENTAL
}

enum AttachmentType {
  IMAGE
  DOCUMENT
  VIDEO
}

// Additional enums for sync functionality
enum SyncStatus {
  PENDING
  SYNCED
  CONFLICT
  FAILED
}

enum SyncDirection {
  TO_SERVER
  FROM_SERVER
  BIDIRECTIONAL
}
